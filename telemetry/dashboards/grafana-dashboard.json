{
  "dashboard": {
    "id": null,
    "title": "Nexus Observability",
    "timezone": "browser",
    "panels": [
      {
        "type": "graph",
        "title": "Latência média por integração",
        "datasource": "OTLP-Metrics",
        "targets": [
          {
            "expr": "latency_ms{scope=\"llm\"}",
            "legendFormat": "LLM"
          },
          {
            "expr": "latency_ms{scope=\"ocr\"}",
            "legendFormat": "OCR"
          },
          {
            "expr": "latency_ms{scope=\"erp\"}",
            "legendFormat": "ERP"
          }
        ]
      },
      {
        "type": "stat",
        "title": "Taxa de erro (última hora)",
        "datasource": "OTLP-Metrics",
        "targets": [
          {
            "expr": "sum(rate(error_rate[1h])) by (scope)",
            "legendFormat": "{{scope}}"
          }
        ]
      },
      {
        "type": "table",
        "title": "Retries e Throughput",
        "datasource": "OTLP-Metrics",
        "targets": [
          {
            "expr": "sum(rate(retries[5m])) by (scope)",
            "legendFormat": "Retries"
          },
          {
            "expr": "sum(rate(throughput[5m])) by (scope)",
            "legendFormat": "Throughput"
          }
        ]
      },
      {
        "type": "graph",
        "title": "Latência p95 por agente",
        "datasource": "OTLP-Metrics",
        "targets": [
          {
            "expr": "histogram_quantile(0.95, sum(rate(agent_latency_ms_bucket[5m])) by (le, agent))",
            "legendFormat": "{{agent}}"
          }
        ]
      },
      {
        "type": "stat",
        "title": "Taxa de sucesso dos agentes (SLO 99%)",
        "datasource": "OTLP-Metrics",
        "targets": [
          {
            "expr": "sum(rate(agent_success_total[5m])) by (agent) / (sum(rate(agent_success_total[5m])) by (agent) + sum(rate(agent_error_total[5m])) by (agent))",
            "legendFormat": "{{agent}}"
          }
        ]
      },
      {
        "type": "stat",
        "title": "Inconsistências detectadas por agente (últimos 5m)",
        "datasource": "OTLP-Metrics",
        "targets": [
          {
            "expr": "sum(rate(agent_inconsistencies_total[5m])) by (agent)",
            "legendFormat": "{{agent}}"
          }
        ]
      }
    ],
    "templating": {
      "list": []
    }
  },
  "overwrite": true
}
